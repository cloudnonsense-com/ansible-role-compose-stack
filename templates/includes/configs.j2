{# includes/configs.j2 #}
{% set all_configs = services | selectattr('configs', 'defined') | map(attribute='configs') | flatten | list %}
{% if all_configs | length > 0 %}
configs:
{% for config in all_configs %}
  "{{ config.source }}":
    content: |
      {{ lookup('template', role_path ~ '/templates/' ~ stack.type ~ '/' ~ config.source ~ '.j2') | indent(6) }}
{% endfor %}
{% endif %}
{# end #}