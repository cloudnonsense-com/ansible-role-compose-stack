---
- name: Verify
  hosts: all
  gather_facts: False
  tasks:
    - name: Check demo-dev compose stack status
      ansible.builtin.command: docker compose -f /opt/apps/demo-dev/compose.yml ps
      register: compose_stack
      changed_when: false

    - name: Verify compose stack has healthy containers
      ansible.builtin.assert:
        that:
          - "compose_stack.stdout is search('demo.*\\(healthy\\)')"
        fail_msg: "Demo service is not healthy in demo-dev stack"
        success_msg: "Demo service is healthy"
